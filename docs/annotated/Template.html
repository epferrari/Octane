<!DOCTYPE html>

<html>
<head>
  <title>Template.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="Collection.html">
                  Collection.js
                </a>
              
                
                <a class="source" href="Compiler.html">
                  Compiler.js
                </a>
              
                
                <a class="source" href="Component.html">
                  Component.js
                </a>
              
                
                <a class="source" href="Controller.html">
                  Controller.js
                </a>
              
                
                <a class="source" href="DOM.html">
                  DOM.js
                </a>
              
                
                <a class="source" href="Dictionary.html">
                  Dictionary.js
                </a>
              
                
                <a class="source" href="Events.html">
                  Events.js
                </a>
              
                
                <a class="source" href="Factory.html">
                  Factory.js
                </a>
              
                
                <a class="source" href="Hinter.html">
                  Hinter.js
                </a>
              
                
                <a class="source" href="OctaneBase.html">
                  OctaneBase.js
                </a>
              
                
                <a class="source" href="OctaneModal.html">
                  OctaneModal.js
                </a>
              
                
                <a class="source" href="OctaneModel.html">
                  OctaneModel.js
                </a>
              
                
                <a class="source" href="OctaneModule.html">
                  OctaneModule.js
                </a>
              
                
                <a class="source" href="OctanePage.html">
                  OctanePage.js
                </a>
              
                
                <a class="source" href="Quarterback.html">
                  Quarterback.js
                </a>
              
                
                <a class="source" href="Router.html">
                  Router.js
                </a>
              
                
                <a class="source" href="Template.html">
                  Template.js
                </a>
              
                
                <a class="source" href="Translator.html">
                  Translator.js
                </a>
              
                
                <a class="source" href="ViewFrame.html">
                  ViewFrame.js
                </a>
              
                
                <a class="source" href="ViewModel.html">
                  ViewModel.js
                </a>
              
                
                <a class="source" href="_octane.html">
                  _octane.js
                </a>
              
                
                <a class="source" href="app-model.html">
                  app-model.js
                </a>
              
                
                <a class="source" href="debug.html">
                  debug.js
                </a>
              
                
                <a class="source" href="extend.html">
                  extend.js
                </a>
              
                
                <a class="source" href="filters.html">
                  filters.js
                </a>
              
                
                <a class="source" href="http.html">
                  http.js
                </a>
              
                
                <a class="source" href="logger.html">
                  logger.js
                </a>
              
                
                <a class="source" href="ui-layers.html">
                  ui-layers.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Template.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> _ 					= <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);
<span class="hljs-keyword">var</span> appFilters 	= <span class="hljs-built_in">require</span>(<span class="hljs-string">'./_octane.js'</span>).filters;
<span class="hljs-keyword">var</span> utils 			= <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils.js'</span>);
<span class="hljs-keyword">var</span> _octane			= <span class="hljs-built_in">require</span>(<span class="hljs-string">'./_octane.js'</span>);
<span class="hljs-keyword">var</span> Compiler 		= <span class="hljs-built_in">require</span>(<span class="hljs-string">'./Compiler.js'</span>);
<span class="hljs-keyword">var</span> Factory 		= <span class="hljs-built_in">require</span>(<span class="hljs-string">'./Factory.js'</span>);

<span class="hljs-keyword">var</span> Template = Factory({

	<span class="hljs-comment">/* Proto Methods */</span>

	initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>)</span>{
								<span class="hljs-keyword">if</span>(!elem) <span class="hljs-keyword">return</span>;
								<span class="hljs-keyword">this</span>.name = elem.getAttribute(<span class="hljs-string">'name'</span>) || elem.octane_id || <span class="hljs-keyword">this</span>.guid(elem);
								<span class="hljs-keyword">this</span>.raw 	= elem.innerHTML;
								<span class="hljs-keyword">this</span>.content = <span class="hljs-string">''</span>;
							},
	set: 				<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>{

								_.isObject(data) || (data = {});

								<span class="hljs-keyword">this</span>.content = Template.interpolate(<span class="hljs-keyword">this</span>.raw,data);
								<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
							},
	render: 		<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dest</span>)</span>{
								<span class="hljs-keyword">return</span> Template._render(<span class="hljs-keyword">this</span>,<span class="hljs-literal">null</span>,<span class="hljs-string">'mountable'</span>);
							},

	prependTo: 	<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dest</span>)</span>{
								Template._render(<span class="hljs-keyword">this</span>,dest,<span class="hljs-string">'prepend'</span>);
							},
	appendTo: 	<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">dest</span>)</span>{
								Template._render(<span class="hljs-keyword">this</span>,dest,<span class="hljs-string">'append'</span>);
							},
	save: 			<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
								<span class="hljs-keyword">if</span>(!_octane.templates[<span class="hljs-keyword">this</span>.name]){
									_octane.templates[<span class="hljs-keyword">this</span>.name] = <span class="hljs-keyword">this</span>;
								}<span class="hljs-keyword">else</span>{
									<span class="hljs-keyword">this</span>.log(<span class="hljs-string">'Could not create template '</span>+<span class="hljs-keyword">this</span>.name+<span class="hljs-string">'. Already exists'</span>);
								}
							}
},{

	<span class="hljs-comment">/* Static Methods */</span>

	get: 				<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>)</span>{

								<span class="hljs-keyword">if</span>(_octane.templates[name]){
									<span class="hljs-keyword">return</span> _octane.templates[name];
								} <span class="hljs-keyword">else</span> {
									<span class="hljs-keyword">this</span>.log(<span class="hljs-string">'Template '</span>+name+<span class="hljs-string">' does not exist'</span>);
								}
							},

	create: 		<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>)</span>{
								<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Template(elem);
							},

	fromString: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name,markup</span>)</span>{

								<span class="hljs-keyword">if</span>(!markup) {
									markup = name;
									name = <span class="hljs-literal">undefined</span>;
								}
									<span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
									div.name = name;
									div.innerHTML = markup;
									<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Template(div);
							},

	compile: 		<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">scope</span>)</span>{

								scope || (scope = <span class="hljs-built_in">document</span>);

								<span class="hljs-keyword">var</span> tmpls = scope.querySelectorAll(<span class="hljs-string">'script[type="text/octane-template"],o-template'</span>);
								<span class="hljs-keyword">var</span> t = tmpls.length;

								<span class="hljs-keyword">while</span>(t--){
									<span class="hljs-keyword">this</span>._cache(tmpls[t]);
								}
							},

	_cache: 		<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">elem</span>)</span>{

								<span class="hljs-keyword">if</span>(elem){</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>compile nested templates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>									<span class="hljs-keyword">this</span>.compile(elem);
									<span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>.create(elem);
									tmp.save();
									elem.parentElement.removeChild(elem);
								}
							},

	interpolate:  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">markup,data</span>)</span>{

									<span class="hljs-keyword">var</span> pattern = <span class="hljs-regexp">/\{\{([^{^}]+)\}\}/g</span>;
									<span class="hljs-keyword">var</span> matches = markup.match(pattern);
									<span class="hljs-keyword">var</span> n;

									<span class="hljs-keyword">if</span>(_.isArray(matches)){
										n = matches.length;
										<span class="hljs-keyword">while</span>(n--){
											markup = <span class="hljs-keyword">this</span>._interpolate(markup,matches[n],data);
										}
									}
									<span class="hljs-keyword">return</span> markup;
								},

	_interpolate: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">markup,match,data</span>)</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>begin: {{postedBy.firstName @filter:myFilter(param) @default(value)}}</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> stripped = match.replace(<span class="hljs-regexp">/[{}]+/g</span>,<span class="hljs-string">''</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>^result: postedBy.firstName @filter:myFilter(param) @default(value)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> split = stripped.split(<span class="hljs-regexp">/\s/</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>^result: [“postedBy.firstName”,”@filter:myFilter”,”@default(value)”]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> key = split.shift();</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>^result: “postedBy.firstName”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> modifiers = split.join(<span class="hljs-string">' '</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>^result: “@filter:myFilter(param) @default(value)”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> filterString 	= (modifiers.match( <span class="hljs-regexp">/@filter:(?=([^\s]+))/</span> ) || [<span class="hljs-string">''</span>,<span class="hljs-string">''</span>])[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>^result: “myFilter(param)”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> filter				= (filterString.match( <span class="hljs-regexp">/^([^(]+)/</span> )  || [<span class="hljs-string">''</span>,<span class="hljs-string">''</span>])[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>^result: “myFilter”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> filterParams 	= (filterString.match( <span class="hljs-regexp">/\((.*)\)/</span> ) || [<span class="hljs-string">''</span>,<span class="hljs-string">''</span>])[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>^result: “param”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> defaultValue = (modifiers.match( <span class="hljs-regexp">/@default\((?:(.*))\)/</span> ) || [<span class="hljs-string">''</span>,<span class="hljs-string">''</span>])[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>^result: “value”</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> nested = key.split(<span class="hljs-string">'.'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>result: [“postedBy”,”firstName”]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> n = nested.length;

								<span class="hljs-keyword">var</span> value = nested.reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prev,curr,index</span>)</span>{
										<span class="hljs-keyword">if</span>(index === (n-<span class="hljs-number">1</span>) &amp;&amp; _.isObject(prev)){ 							<span class="hljs-comment">// last iteration</span>
											<span class="hljs-keyword">return</span> prev[curr]; 																	<span class="hljs-comment">// return value</span>
										}
										<span class="hljs-keyword">if</span>(_.isObject(prev)){
											<span class="hljs-keyword">return</span> prev[curr]; 																	<span class="hljs-comment">// go one level deeper</span>
										} <span class="hljs-keyword">else</span> {
											<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; 																				<span class="hljs-comment">// no further nesting, value defined in key does not exist</span>
										}
								},data); 																									<span class="hljs-comment">// start with data object passed to template</span>

								<span class="hljs-keyword">if</span>(value === <span class="hljs-literal">undefined</span> || value === <span class="hljs-literal">null</span>){
									<span class="hljs-keyword">if</span>(defaultValue.length &gt;<span class="hljs-number">0</span>) value = defaultValue;
									<span class="hljs-keyword">else</span> value = <span class="hljs-string">''</span>
								}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>apply filter if present
filter is applied to this arg with val and model properties set</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">if</span>(filter.length &gt; <span class="hljs-number">0</span>){
									<span class="hljs-keyword">var</span> paramsArray = filterParams.split(<span class="hljs-string">','</span>);
									<span class="hljs-keyword">try</span>{
										<span class="hljs-keyword">if</span>(appFilters[filter]){
											value = appFilters[filter].apply({input:value,model:data},paramsArray);
										} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isFunction(<span class="hljs-string">''</span>[filter])){
											value = <span class="hljs-string">''</span>[filter].apply(value,paramsArray);
										} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isFunction(utils[filter])){
											value = utils[filter](value,params);
										}
									} <span class="hljs-keyword">catch</span> (err){
										<span class="hljs-keyword">this</span>.log(<span class="hljs-string">'Could not filter data '</span>+value,err);
									}
								}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>replace all occurences of {{postedBy.firstName @filter:myFilter @param:myParam}}
in template with filtered value of data.postedBy.firstName,
or data.postedBy.firstName if “myFilter” didn’t exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">return</span>  markup.replace(match,value);
							},

	_render: 		<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">template,dest,method</span>)</span>{

								<span class="hljs-keyword">if</span>(template.content == <span class="hljs-string">''</span>) template.content = template.raw;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>a surrogate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								<span class="hljs-keyword">var</span> span = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'span'</span>);
								<span class="hljs-keyword">var</span> nodes,returnNode;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>turn surrogate html into nodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>								span.innerHTML = template.content;
								span.normalize();
								nodes = span.childNodes;

								<span class="hljs-keyword">if</span>(method === <span class="hljs-string">'prepend'</span>){
									<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;
									<span class="hljs-keyword">var</span> n=nodes.length,node;
									<span class="hljs-keyword">var</span> firstChild = dest.firstChild;
									<span class="hljs-keyword">for</span>(;i&lt;n;i++){
											node = nodes[i];
											<span class="hljs-keyword">if</span>(node &amp;&amp; node.nodeType == (Node.ELEMENT_NODE || Node.TEXT_NODE)){
												dest.insertBefore(node,firstChild);
											}
									}
								} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(method === <span class="hljs-string">'append'</span>){
									<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>,n=nodes.length,node;
									<span class="hljs-keyword">for</span>(;i&lt;n;i++){
											node = nodes[i];
											<span class="hljs-keyword">if</span>(node &amp;&amp; node.nodeType == (Node.ELEMENT_NODE || Node.TEXT_NODE)){
												dest.appendChild(nodes[i]);
											}
									}
								} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(method === <span class="hljs-string">'mountable'</span>){
									<span class="hljs-keyword">if</span>(nodes.length === <span class="hljs-number">1</span>){
										returnNode = span.firstElementChild;
									} <span class="hljs-keyword">else</span> {
										returnNode = span;
									}
								} <span class="hljs-keyword">else</span> {
									dest.innerHTML = template.content;
								}
								template.content = <span class="hljs-string">''</span>;
								<span class="hljs-keyword">if</span>(_octane.initialized) Compiler.complileAll(dest);
								<span class="hljs-keyword">return</span> returnNode;
							},


});

<span class="hljs-built_in">module</span>.exports = Template;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
